# --*-- coding: utf8 --*--
#

import requests
import pandas as pd
import json
from data_conf import location_conf, age_conf, measure_conf, sex_conf, cause_conf, metric_conf



if __name__ == "__main__":
    url = "http://ghdx.healthdata.org/sites/all/modules/custom/ihme_query_tool/gbd-search/php/data.php"
    headers = {
        "Host": "ghdx.healthdata.org",
        "Origin": "http://ghdx.healthdata.org",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36",
    }
    data = {
        "version": "376",
        "year[0]": "2017",
        "age[0]": "22",
        "cause[0]": "298",
        "location[0]": "33",
        "location[1]": "34",
        "location[2]": "35",
        "location[3]": "36",
        "location[4]": "37",
        "location[5]": "38",
        "location[6]": "39",
        "location[7]": "40",
        "location[8]": "41",
        "location[9]": "43",
        "location[10]": "44",
        "location[11]": "45",
        "location[12]": "46",
        "location[13]": "47",
        "location[14]": "48",
        "location[15]": "49",
        "location[16]": "50",
        "location[17]": "51",
        "location[18]": "52",
        "location[19]": "53",
        "location[20]": "54",
        "location[21]": "55",
        "location[22]": "57",
        "location[23]": "58",
        "location[24]": "59",
        "location[25]": "60",
        "location[26]": "61",
        "location[27]": "62",
        "location[28]": "63",
        "location[29]": "71",
        "location[30]": "72",
        "location[31]": "66",
        "location[32]": "67",
        "location[33]": "68",
        "location[34]": "69",
        "location[35]": "101",
        "location[36]": "349",
        "location[37]": "102",
        "location[38]": "97",
        "location[39]": "98",
        "location[40]": "99",
        "location[41]": "74",
        "location[42]": "75",
        "location[43]": "76",
        "location[44]": "77",
        "location[45]": "78",
        "location[46]": "79",
        "location[47]": "80",
        "location[48]": "81",
        "location[49]": "82",
        "location[50]": "83",
        "location[51]": "84",
        "location[52]": "85",
        "location[53]": "86",
        "location[54]": "87",
        "location[55]": "88",
        "location[56]": "89",
        "location[57]": "90",
        "location[58]": "91",
        "location[59]": "92",
        "location[60]": "93",
        "location[61]": "94",
        "location[62]": "95",
        "location[63]": "121",
        "location[64]": "122",
        "location[65]": "123",
        "location[66]": "105",
        "location[67]": "106",
        "location[68]": "107",
        "location[69]": "108",
        "location[70]": "305",
        "location[71]": "109",
        "location[72]": "110",
        "location[73]": "111",
        "location[74]": "112",
        "location[75]": "113",
        "location[76]": "114",
        "location[77]": "115",
        "location[78]": "385",
        "location[79]": "116",
        "location[80]": "117",
        "location[81]": "118",
        "location[82]": "119",
        "location[83]": "422",
        "location[84]": "125",
        "location[85]": "126",
        "location[86]": "127",
        "location[87]": "128",
        "location[88]": "129",
        "location[89]": "130",
        "location[90]": "131",
        "location[91]": "132",
        "location[92]": "133",
        "location[93]": "135",
        "location[94]": "136",
        "location[95]": "160",
        "location[96]": "139",
        "location[97]": "140",
        "location[98]": "141",
        "location[99]": "142",
        "location[100]": "143",
        "location[101]": "144",
        "location[102]": "145",
        "location[103]": "146",
        "location[104]": "147",
        "location[105]": "148",
        "location[106]": "149",
        "location[107]": "150",
        "location[108]": "151",
        "location[109]": "152",
        "location[110]": "522",
        "location[111]": "153",
        "location[112]": "154",
        "location[113]": "155",
        "location[114]": "156",
        "location[115]": "157",
        "location[116]": "161",
        "location[117]": "162",
        "location[118]": "163",
        "location[119]": "164",
        "location[120]": "165",
        "location[121]": "6",
        "location[122]": "7",
        "location[123]": "8",
        "location[124]": "298",
        "location[125]": "25",
        "location[126]": "22",
        "location[127]": "351",
        "location[128]": "23",
        "location[129]": "24",
        "location[130]": "376",
        "location[131]": "26",
        "location[132]": "27",
        "location[133]": "28",
        "location[134]": "29",
        "location[135]": "30",
        "location[136]": "10",
        "location[137]": "11",
        "location[138]": "12",
        "location[139]": "13",
        "location[140]": "14",
        "location[141]": "183",
        "location[142]": "15",
        "location[143]": "16",
        "location[144]": "17",
        "location[145]": "186",
        "location[146]": "18",
        "location[147]": "19",
        "location[148]": "20",
        "location[149]": "168",
        "location[150]": "169",
        "location[151]": "170",
        "location[152]": "171",
        "location[153]": "172",
        "location[154]": "173",
        "location[155]": "175",
        "location[156]": "176",
        "location[157]": "177",
        "location[158]": "178",
        "location[159]": "179",
        "location[160]": "180",
        "location[161]": "181",
        "location[162]": "182",
        "location[163]": "184",
        "location[164]": "185",
        "location[165]": "187",
        "location[166]": "435",
        "location[167]": "189",
        "location[168]": "190",
        "location[169]": "191",
        "location[170]": "193",
        "location[171]": "194",
        "location[172]": "195",
        "location[173]": "196",
        "location[174]": "197",
        "location[175]": "198",
        "location[176]": "200",
        "location[177]": "201",
        "location[178]": "202",
        "location[179]": "203",
        "location[180]": "204",
        "location[181]": "205",
        "location[182]": "206",
        "location[183]": "207",
        "location[184]": "208",
        "location[185]": "209",
        "location[186]": "210",
        "location[187]": "211",
        "location[188]": "212",
        "location[189]": "213",
        "location[190]": "214",
        "location[191]": "215",
        "location[192]": "216",
        "location[193]": "217",
        "location[194]": "218",
        "measure[0]": "1",
        "measure[1]": "2",
        "sex[0]": "3",
        "metric[0]": "1",
        "base": "single",
        "context": "cause",
    }
    # 发起post请求
    response = requests.post(url, data=data, headers=headers)
    content = response.text
    data = json.loads(content)
    df_data = pd.DataFrame(data["data"], columns=data["cols"])
    df_data["location"] = df_data["location"].map(location_conf)
    df_data["age"] = df_data["age"].map(age_conf)
    df_data["measure"] = df_data["measure"].map(measure_conf)
    df_data["sex"] = df_data["sex"].map(sex_conf)
    df_data["cause"] = df_data["cause"].map(cause_conf)
    df_data["metric"] =df_data["metric"].map(metric_conf)

    df_data.to_csv("HIV_global.csv", index=False)